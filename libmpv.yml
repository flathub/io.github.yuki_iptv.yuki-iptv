name: libmpv
cleanup:
  - /share/bash-completion
  - /share/zsh
  - /share/doc
  - /share/icons
  - /share/applications
buildsystem: meson
config-opts:
  - -Dlibmpv=true
  - -Dcplayer=false
  - -Dlua=enabled
  - -Ddebug=false
  - -Dbuild-date=false
  - -Dalsa=disabled
  - -Dmanpage-build=disabled
  - -Dvulkan=enabled
  - -Dx11=enabled
  - -Dwayland=enabled
  - -Ddrm=enabled
sources:
  - type: archive
    url: https://github.com/mpv-player/mpv/archive/refs/tags/v0.40.0.tar.gz
    sha256: 10a0f4654f62140a6dd4d380dcf0bbdbdcf6e697556863dc499c296182f081a3
    x-checker-data:
      type: anitya
      project-id: 5348
      stable-only: true
      url-template: https://github.com/mpv-player/mpv/archive/refs/tags/v$version.tar.gz
  - type: patch
    path: fix-hwdec.diff
modules:
  - shared-modules/luajit/luajit.json

  - name: vapoursynth
    config-opts:
      - --with-python-prefix=/app

    sources:
      - type: archive
        url: https://github.com/vapoursynth/vapoursynth/archive/72.tar.gz
        sha256: f8fcc5e2e9d2195454310e3356ea13e5334125891e452cc6543e985f28cacd22
        x-checker-data:
          type: anitya
          project-id: 15982
          stable-only: true
          url-template: https://github.com/vapoursynth/vapoursynth/archive/$version.tar.gz
    modules:
      - name: zimg
        config-opts:
          - --disable-static
        cleanup:
          - /include
          - /lib/pkgconfig
          - /share/doc
        sources:
          - type: archive
            archive-type: tar
            url: https://api.github.com/repos/sekrit-twc/zimg/tarball/release-3.0.6
            sha256: 15140e491c4ce9db5f02a038d8a1eb53e9151b55eeed06a2899425a6ebfef367
            x-checker-data:
              type: json
              url: https://api.github.com/repos/sekrit-twc/zimg/releases/latest
              url-query: .tarball_url
              version-query: .tag_name | sub("^release-"; "")
              timestamp-query: .published_at

  - name: libplacebo
    buildsystem: meson
    config-opts:
      - -Dopengl=enabled
      - -Dvulkan=enabled
      - -Dglslang=disabled
      - -Dd3d11=disabled
      - -Ddemos=false
    cleanup:
      - /include
      - /lib/pkgconfig
    sources:
      - type: git
        url: https://github.com/haasn/libplacebo.git
        tag: v7.351.0
        commit: 3188549fba13bbdf3a5a98de2a38c2e71f04e21e
        x-checker-data:
          type: git
          tag-pattern: ^v([\d.]+)$
      - type: patch
        path: libplacebo-python-3.14.patch
    modules:
      # runtime shaderc is broken for mpv build.
      # OSError: /usr/lib/x86_64-linux-gnu/libshaderc_shared.so.1: undefined symbol: _ZTVN8spvtools5utils5TimerE
      - name: shaderc
        buildsystem: cmake-ninja
        builddir: true
        config-opts:
          - -DSHADERC_SKIP_COPYRIGHT_CHECK=ON
          - -DSHADERC_SKIP_EXAMPLES=ON
          - -DSHADERC_SKIP_TESTS=ON
          - -DSPIRV_SKIP_EXECUTABLES=ON
          - -DENABLE_GLSLANG_BINARIES=OFF
        cleanup:
          - /bin
          - /include
          - /lib/cmake
          - /lib/pkgconfig
        sources:
          - type: git
            url: https://github.com/google/shaderc.git
            tag: v2025.4
            commit: 73743588fe9c39f2f1c780a087d94afac691a189
            x-checker-data:
              type: git
              tag-pattern: ^v(\d{4}\.\d{1,2})$
          - type: git
            url: https://github.com/KhronosGroup/SPIRV-Headers.git
            tag: vulkan-sdk-1.4.328.1
            commit: 01e0577914a75a2569c846778c2f93aa8e6feddd
            dest: third_party/spirv-headers
            x-checker-data:
              type: git
              tag-pattern: ^vulkan-sdk-([\d.]+)$
          - type: git
            url: https://github.com/KhronosGroup/SPIRV-Tools.git
            tag: vulkan-sdk-1.4.328.1
            commit: 7f2d9ee926f98fc77a3ed1e1e0f113b8c9c49458
            dest: third_party/spirv-tools
            x-checker-data:
              type: git
              tag-pattern: ^vulkan-sdk-([\d.]+)$
          - type: git
            url: https://github.com/KhronosGroup/glslang.git
            tag: vulkan-sdk-1.4.328.1
            commit: a57276bf558f5cf94d3a9854ebdf5a2236849a5a
            dest: third_party/glslang
            x-checker-data:
              type: git
              tag-pattern: ^vulkan-sdk-([\d.]+)$

  - name: libXpresent
    buildsystem: autotools
    sources:
      - type: archive
        url: https://xorg.freedesktop.org/archive/individual/lib/libXpresent-1.0.2.tar.xz
        sha256: 4e5b21b4812206a4b223013606ae31170502c1043038777a1ef8f70c09d37602
        x-checker-data:
          type: anitya
          project-id: 17166
          stable-only: true
          url-template: https://xorg.freedesktop.org/archive/individual/lib/libXpresent-$version.tar.xz

  - name: libass
    config-opts:
      - --disable-static
    sources:
      - type: archive
        url: https://github.com/libass/libass/releases/download/0.17.4/libass-0.17.4.tar.gz
        sha256: a886b3b80867f437bc55cff3280a652bfa0d37b43d2aff39ddf3c4f288b8c5a8
        x-checker-data:
          type: anitya
          project-id: 1560
          stable-only: true
          url-template: https://github.com/libass/libass/releases/download/$version/libass-$version.tar.gz

  - name: uchardet
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_POLICY_VERSION_MINIMUM=3.5
      - -DCMAKE_BUILD_TYPE=Release
      - -DBUILD_STATIC=0
    cleanup:
      - /bin
    sources:
      - type: archive
        url: https://www.freedesktop.org/software/uchardet/releases/uchardet-0.0.8.tar.xz
        sha256: e97a60cfc00a1c147a674b097bb1422abd9fa78a2d9ce3f3fdcc2e78a34ac5f0
        x-checker-data:
          type: anitya
          project-id: 9265
          stable-only: true
          url-template: https://www.freedesktop.org/software/uchardet/releases/uchardet-$version.tar.xz

  # Needed for mpv 0.40 vaapi support
  - name: libdisplay-info
    buildsystem: meson
    sources:
      - type: archive
        url: https://gitlab.freedesktop.org/emersion/libdisplay-info/-/archive/0.2.0/libdisplay-info-0.3.0.tar.gz
        sha256: a0fe86d4b43a6347cdd8192f307d19b81d31401fe55251be0576bdbe0b519d7f
        x-checker-data:
          type: anitya
          project-id: 326668
          stable-only: true
          url-template: https://gitlab.freedesktop.org/emersion/libdisplay-info/-/archive/0.2.0/libdisplay-info-$version.tar.gz

    modules:
      - name: hwdata
        sources:
          - type: archive
            url: https://github.com/vcrhonek/hwdata/archive/refs/tags/v0.401.tar.gz
            sha256: e9ff93b9807cc014ed8f7f5cb5dc2c31e714058c82ddc59b7355f5c57c9b759e
            x-checker-data:
              type: anitya
              project-id: 5387
              stable-only: true
              url-template: https://github.com/vcrhonek/hwdata/archive/refs/tags/v$version.tar.gz

  - name: yt-dlp
    no-autogen: true
    no-make-install: true
    make-args:
      - yt-dlp
      - PYTHON=/usr/bin/python3
    post-install:
      - install yt-dlp /app/bin
    sources:
      - type: archive
        url: https://github.com/yt-dlp/yt-dlp/archive/refs/tags/2025.10.22.tar.gz
        sha256: ef21d5427e896d46180408dc1feb0da19bf0a97876b0f10b15f6304fa496991c
        x-checker-data:
          type: anitya
          project-id: 143399
          stable-only: true
          url-template: https://github.com/yt-dlp/yt-dlp/archive/refs/tags/$version.tar.gz
